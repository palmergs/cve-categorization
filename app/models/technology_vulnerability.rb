class TechnologyVulnerability < ApplicationRecord
  include Concerns::HasIds

  belongs_to :technology
  belongs_to :vulnerability

  validates :vulnerability, presence: true
  validates :technology, presence: true, uniqueness: { 
    scope: :vulnerability_id }
  validates :term_indicator, :user_indicator, presence: true, numericality: { 
    integer_only: true, 
    greater_than: -4, 
    less_than: 4 }
  validates :total_indicator, presence: true, numericality: { 
    integer_only: true }

  before_save do |obj|
    obj.total_indicator = obj.term_indicator + obj.user_indicator
  end

  scope :by_technology, ->(id) {
    where(technology_id: id.to_i) if id
  }

  scope :by_vulnerability, ->(id) {
    where(vulnerability_id: id.to_i) if id
  }

end
