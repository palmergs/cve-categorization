class Reference < ApplicationRecord
  include Concerns::HasIds

  belongs_to :vulnerability

  validates :vulnerability_id, presence: true
  validates :url, presence: true, uniqueness: { scope: :vulnerability_id }

  scope :by_vulnerability, ->(id) { where(vulnerability_id: Integer(id)) if id.present? }

  scope :by_query, ->(q) {
    if q
      str = sanitize_sql_like(q)
      if str.present?
        # HACK: references seems to mean something special in SQLIte? Wrapping
        # in quotes keeps the query from failing.
        where('"references"."url" like ?', "%#{ str }%")
      else
        where('9=8')
      end
    end
  }


end
