# Technology that may be affected by Vulnerabilities
class Technology < ApplicationRecord
  include Concerns::HasIds

  has_many :terms, dependent: :destroy
  has_many :assessments, dependent: :destroy
  has_many :vulnerabilities, through: :assessments

  validates :name, presence: true, uniqueness: true

  scope :by_query, ->(q) {
    if q.present?
      str = normalize_query(q)
      if str.length > 1
        where('technologies.name like ?', "%#{ str }%")
      else
        where('1=0')
      end
    end
  }
end
