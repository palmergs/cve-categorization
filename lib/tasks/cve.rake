require 'cve_file_parser'
require 'cve_mem_parser'

namespace :cve do
  desc "load a collection of CVEs from file"
  task :import, [:path] => [:environment] do |t, args|
    path = args[:path]
    abort("File not found :: #{ path }") unless File.readable?(path)
    p "Parsing :: #{ path }"
    parser = CveFileParser.new(path)
    parser.parse
    p "Complete :: #{ Vulnerability.count } CVEs in database"
  end

  desc "load a CVE file by year"
  task :by_year, [:year] => [:environment] do |t, args|
    year = Integer(args[:year])
    p "Parsing by year :: #{ year }"
    parser = CveMemParser.new("http://cve.mitre.org/data/downloads/allitems-cvrf-year-#{ year }.xml")
    parser.parse
    p "Complete :: #{ Vulnerability.count } CVEs in database"
  end
end
