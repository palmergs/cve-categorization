import Ember from 'ember';

export default Ember.Component.extend({
  tagName: 'p',

  modalActive: false,

  currentTextSelection() {
    let text = "";
    if (window.getSelection) {
        text = window.getSelection().toString();
    } else if (document.selection && document.selection.type != "Control") {
        text = document.selection.createRange().text;
    }
    return text;
  },

  doubleClick() {
    this.prepareModal();
  },

  mouseUp() {
    this.prepareModal();
  },

  prepareModal() {
    const active = this.get('modalActive');
    if(!active) {
      let text = this.currentTextSelection();
      if(text && text.trim().length > 0) {
        this.set('selectedText', text.trim());
        this.set('modalActive', true);
      }
    }
  },

  actions: {
    cancelModal() {
      this.set('selectedText', null);
      this.set('modalActive', false);
    },

    isLikelyTerm() {
      const text = this.get('selectedText');
      this.set('selectedText', null);
      this.set('isProcessing', true);
      this.sendAction('termAdded', text, 1);
      this.set('isProcessing', false);
      this.set('modalActive', false);
    },

    isUnlikelyTerm() {
      const text = this.get('selectedText');
      this.set('selectedText', null);
      this.set('isProcessing', true);
      this.sendAction('termAdded', text, -1);
      this.set('isProcessing', false);
      this.set('modalActive', false);
    }
  }
});
