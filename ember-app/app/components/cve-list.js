import Ember from 'ember';
import ENV from '../config/environment';

export default Ember.Component.extend({
  assess: 0,
  techId: null,
  selected: false,
  badgeColor: Ember.computed('assess', function() {
    switch(this.get('assess')) {
      case -2: return 'is-success';
      case -1: return 'is-info';
      case 1: return 'is-warning';
      case 2: return 'is-danger';
      default: return 'is-primary';
    }
  }),
  headerText: Ember.computed('assess', function() {
    switch(this.get('assess')) {
      case -2: return 'Nope!';
      case -1: return 'Probably Not';
      case 1: return 'Maybe?';
      case 2: return 'Definitely!';
      default: return 'Who Knows?';
    }
  }),
  selectedClass: Ember.computed('selected', function() {
    return this.get('selected') ? 'is-selected' : '';
  }),

  baseDownloadPath: Ember.computed('techId', function() {
    return `${ ENV['apiHost'] }/${ ENV['apiNamespace'] }`;
  }),

  textDownloadPath: Ember.computed('baseDownloadPath', function() {
    const downloadParams = `technology_id=${ this.get('techId' )}&filter[assess]=${ this.get('assess') }`;
    return `${ this.get('baseDownloadPath') }/assessments.txt?${ downloadParams }`;
  }),

  xmlDownloadPath: Ember.computed('baseDownloadPath', function() {
    const downloadParams = `technology_id=${ this.get('techId' )}&filter[assess]=${ this.get('assess') }`;
    return `${ this.get('baseDownloadPath') }/assessments.xml?${ downloadParams }`;
  }),

  hasMore: Ember.computed('model.meta', function() {
    const page = this.get('model.meta.page'),
        count = this.get('model.meta.page-count');
    return (page && count && page < count);
  }),

  sortColumn: 'id',
  sorted: Ember.computed.sort('model.data', function(a, b) {
    return a.get('id') - b.get('id');
  }),

  actions: {
    onAssessmentChanged(assessment) {
      if(assessment.get('assessment') !== this.get('assess')) {
        this.decrementProperty('model.meta.total');
        this.get('model.data').removeObject(assessment);
        if(this.get('model.data.length') < 4) {
          this.sendAction('loadMore', this.get('assess'));
        }
      }
      this.sendAction('assessmentChanged', assessment);
    },

    onTermAdded(term, value) {
      this.sendAction('termAdded', term, value);
    },

    loadMore() {
      this.sendAction('loadMore', this.get('assess'));
    },

    headerClicked() {
      // this.sendAction('columnClicked', this.get('assess'), this.get('model'));
    }
  }
});
