require 'rails_helper'

RSpec.describe Api::V1::VulnerabilityInspectionsController, type: :controller do

  describe '#index' do
    it 'can query for vulnerability inspections' do
      get :index, format: :json
      expect(response).to be_success
    end
  end

  describe '#show' do
    it 'can return a vulnerability inspection' do
      tv = create(:vulnerability_inspection)
      get :show, format: :json, params: { id: tv.id }
      expect(response).to be_success
    end
  end

  describe '#create' do
    it 'can create a vulnerability inspection' do
      tech = create(:technology)
      vuln = create(:vulnerability)
      post :create, format: :json, params: {
        vulnerability_inspection: {
          technology_id: tech.id,
          vulnerability_id: vuln.id,
          indicator: rand(7) - 3 } }          
      expect(response).to be_success
    end
  end

  describe '#update' do
    it 'can update a vulnerability inspection' do
      tv = create(:vulnerability_inspection)
      put :update, format: :json, params: {
        id: tv.id,
        vulnerability_inspection: { indicator: 3 } }
      expect(response).to be_success
    end
  end

  describe '#destroy' do
    it 'can destroy a vulnerability inspection' do
      tv = create(:vulnerability_inspection)
      delete :destroy, format: :json, params: { id: tv.id }
      expect(response).to be_success
    end
  end

end
