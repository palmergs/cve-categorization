require 'rails_helper'

RSpec.describe Technology, type: :model do
  it 'can be instantiated' do
    expect(Technology.new).to_not be_nil
  end

  it 'can be persisted' do
    expect(create(:technology)).to be_persisted
    expect(create(:technology)).to be_persisted
  end

  describe 'scopes' do
    it 'can query for associatd vulnerabilities' do
      tech = create(:technology)
      ux = tech.user_excluded_cves
      tx = tech.term_excluded_cves
      us = tech.user_selected_cves
      ts = tech.term_selected_cves
      expect(ux + tx + us + ts).to eq(tech.categorized_cves)

      cnt = Vulnerability.count
      expect(tech.uncategorized_cves).to eq(cnt - tech.categorized_cves)
    end
  end
end
